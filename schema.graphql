# source: http://localhost:10001/labbook/
# timestamp: Tue Dec 19 2017 08:42:04 GMT+0000 (GMT)

type ActivityConnection {
  pageInfo: PageInfo!
  edges: [ActivityEdge]!
}

# Container for Activity Detail Records
type ActivityDetailObject implements Node {
  # The ID of the object.
  id: ID!
  key: String
  data: [[String]]
  type: ActivityDetailType
  show: Boolean
  importance: Int
  tags: [String]
}

enum ActivityDetailType {
  NOTE
  LABBOOK
  INPUT_DATA
  CODE
  CODE_EXECUTED
  RESULT
  OUTPUT_DATA
  ENVIRONMENT
}

type ActivityEdge {
  # The item at the end of the edge
  node: ActivityRecordObject

  # A cursor for use in pagination
  cursor: String!
}

# Container for Activity Records
type ActivityRecordObject implements Node {
  # The ID of the object.
  id: ID!
  commit: String
  linkedCommit: String
  message: String
  detailObjects: [ActivityDetailObject]
  type: ActivityType
  show: Boolean
  importance: Int
  tags: [String]
  timestamp: DateTime
}

enum ActivityType {
  NOTE
  ENVIRONMENT
  CODE
  INPUT_DATA
  OUTPUT_DATA
  MILESTONE
  BRANCH
  LABBOOK
}

input AddEnvironmentComponentInput {
  labbookName: String!
  owner: String
  componentClass: EnvironmentComponentClass!
  repository: String!
  namespace: String!
  component: String!
  version: String!
  clientMutationId: String
}

# Mutation to add a new environment component to a LabBook
type AddEnvironmentComponentPayload {
  environmentComponent: EnvironmentComponent
  clientMutationId: String
}

input AddEnvironmentPackageInput {
  labbookName: String!
  owner: String
  packageManager: String!
  packageName: String!
  packageVersion: String
  clientMutationId: String
}

# Mutation to add a new package to labbook. 
type AddEnvironmentPackagePayload {
  environmentPackage: PackageManager
  clientMutationId: String
}

input AddLabbookCollaboratorInput {
  owner: String!
  labbookName: String!
  username: String!
  clientMutationId: String
}

type AddLabbookCollaboratorPayload {
  updatedLabbook: Labbook
  clientMutationId: String
}

input AddLabbookFavoriteInput {
  owner: String!
  labbookName: String!
  section: String!
  key: String!
  description: String
  isDir: Boolean
  index: Int
  clientMutationId: String
}

type AddLabbookFavoritePayload {
  newFavoriteEdge: LabbookFavoriteEdge
  clientMutationId: String
}

input AddLabbookFileInput {
  owner: String!
  labbookName: String!
  section: String!
  filePath: String!
  chunkUploadParams: ChunkUploadInput!
  clientMutationId: String
}

# Mutation to add a file to a labbook. File should be sent in the `uploadFile` key as a multi-part/form upload.
# file_path is the relative path from the labbook section specified.
type AddLabbookFilePayload {
  newLabbookFileEdge: LabbookFileEdge
  clientMutationId: String
}

input AddLabbookRemoteInput {
  owner: String!
  labbookName: String!
  remoteName: String!
  remoteUrl: String!
  clientMutationId: String
}

type AddLabbookRemotePayload {
  success: Boolean
  clientMutationId: String
}

# A type that represents a Base Image Environment Component
type BaseImage implements Node {
  # The ID of the object.
  id: ID!
  component: EnvironmentComponent!
  author: EnvironmentAuthor!
  info: EnvironmentInfo!
  osClass: String!
  osRelease: String!
  server: String!
  namespace: String!
  repository: String!
  tag: String!
  availablePackageManagers: [String]!
}

type BaseImageConnection {
  pageInfo: PageInfo!
  edges: [BaseImageEdge]!
}

type BaseImageEdge {
  # The item at the end of the edge
  node: BaseImage

  # A cursor for use in pagination
  cursor: String!
}

input BuildImageInput {
  owner: String
  labbookName: String!
  clientMutationId: String
}

# Mutator to build a LabBook's Docker Image
type BuildImagePayload {
  environment: Environment
  backgroundJobKey: String
  clientMutationId: String
}

input CheckoutBranchInput {
  owner: String
  labbookName: String!
  branchName: String!
  clientMutationId: String
}

# Mutation checkout an existing branch branch
type CheckoutBranchPayload {
  labbook: Labbook
  clientMutationId: String
}

# Input Object for params needed for a chunked upload
#
# To use, add a field `chunk_upload_params` to your mutation input
input ChunkUploadInput {
  fileSizeKb: Int!
  chunkSize: Int!
  totalChunks: Int!
  chunkIndex: Int!
  filename: String!
  uploadId: String!
}

# An enumeration for container image status
enum ContainerStatus {
  NOT_RUNNING
  STARTING
  RUNNING
}

input CreateBranchInput {
  owner: String
  labbookName: String!
  branchName: String!
  clientMutationId: String
}

# Mutation create a NEW branch for a LabBook LOCALLY
type CreateBranchPayload {
  branch: LabbookRef
  clientMutationId: String
}

input CreateLabbookInput {
  name: String!
  description: String!
  clientMutationId: String
}

# Mutator for creation of a new Labbook on disk
type CreateLabbookPayload {
  labbook: Labbook
  clientMutationId: String
}

input CreateUserNoteInput {
  owner: String
  labbookName: String!
  title: String!
  body: String
  tags: [String]
  clientMutationId: String
}

# Mutation to create a new user note entry in the activity feed of lab book
#
# The `linked_commit` is an empty string since there is no linked commit
type CreateUserNotePayload {
  newActivityRecordEdge: ActivityEdge
  clientMutationId: String
}

# A type that represents a Custom Dependency Environment Component
type CustomDependency implements Node {
  # The ID of the object.
  id: ID!
  component: EnvironmentComponent!
  author: EnvironmentAuthor!
  info: EnvironmentInfo!
  osBaseClass: String!
  docker: String!
}

type CustomDependencyConnection {
  pageInfo: PageInfo!
  edges: [CustomDependencyEdge]!
}

type CustomDependencyEdge {
  # The item at the end of the edge
  node: CustomDependency

  # A cursor for use in pagination
  cursor: String!
}

# The `DateTime` scalar type represents a DateTime
# value as specified by
# [iso8601](https://en.wikipedia.org/wiki/ISO_8601).
scalar DateTime

input DeleteLabbookCollaboratorInput {
  owner: String!
  labbookName: String!
  username: String!
  clientMutationId: String
}

type DeleteLabbookCollaboratorPayload {
  updatedLabbook: Labbook
  clientMutationId: String
}

input DeleteLabbookFileInput {
  owner: String!
  labbookName: String!
  section: String!
  filePath: String!
  isDirectory: Boolean
  clientMutationId: String
}

type DeleteLabbookFilePayload {
  success: Boolean
  clientMutationId: String
}

# A type that represents a Development Environment Environment Component
type DevEnv implements Node {
  # The ID of the object.
  id: ID!
  component: EnvironmentComponent!
  author: EnvironmentAuthor!
  info: EnvironmentInfo!
  osBaseClass: String!
  developmentEnvironmentClass: String!
  installCommands: [String]!
  execCommands: [String]!
  exposedTcpPorts: [String]!
}

type DevEnvConnection {
  pageInfo: PageInfo!
  edges: [DevEnvEdge]!
}

type DevEnvEdge {
  # The item at the end of the edge
  node: DevEnv

  # A cursor for use in pagination
  cursor: String!
}

# A type that represents the Environment for a LabBook
type Environment implements Node {
  # The ID of the object.
  id: ID!
  imageStatus: ImageStatus
  containerStatus: ContainerStatus
  baseImage: BaseImage
  devEnvs(before: String, after: String, first: Int, last: Int): DevEnvConnection
  packageManagerDependencies(before: String, after: String, first: Int, last: Int): PackageManagerConnection
  customDependencies(before: String, after: String, first: Int, last: Int): CustomDependencyConnection
}

# A type that represents the Author of an environment component
type EnvironmentAuthor implements Node {
  # The ID of the object.
  id: ID!
  name: String!
  email: String!
  username: String!
  organization: String
}

# A type that represents the identifiable information for an environment component
type EnvironmentComponent implements Node {
  # The ID of the object.
  id: ID!
  repository: String
  namespace: String
  name: String
  version: String
  componentClass: EnvironmentComponentClass
}

# Enumeration indicating the different classes of Environment Components
#
# base_image - base docker images
# dev_env - development environments
# package_manager - dependencies installed via package managers
# custom - complex dependencies that are installed via custom docker snippets
enum EnvironmentComponentClass {
  base_image
  dev_env
  package_manager
  custom
}

# A type that represents the Info section of an environment component
type EnvironmentInfo implements Node {
  # The ID of the object.
  id: ID!
  name: String!
  humanName: String!
  description: String!
  versionMajor: Int!
  versionMinor: Int!
  tags: [String]
  icon: String
}

input ExportLabbookInput {
  owner: String!
  labbookName: String!
  clientMutationId: String
}

type ExportLabbookPayload {
  jobKey: String
  clientMutationId: String
}

# An interface for any object that is represented by a git commit
interface GitCommit {
  hash: String
  shortHash: String
  committedOn: String
}

# An interface for any git reference
interface GitRef {
  name: String
  prefix: String
}

# An interface for Objects backended with git repositories (LabBook and Datasets)
interface GitRepository {
  name: String
  description: String
  owner: Owner
}

# An enumeration for Docker image status
enum ImageStatus {
  DOES_NOT_EXIST
  BUILD_IN_PROGRESS
  EXISTS
  STALE
  BUILD_FAILED
}

input ImportLabbookInput {
  chunkUploadParams: ChunkUploadInput!
  clientMutationId: String
}

type ImportLabbookPayload {
  importJobKey: String
  buildImageJobKey: String
  clientMutationId: String
}

input ImportRemoteLabbookInput {
  owner: String!
  labbookName: String!
  remoteUrl: String!
  clientMutationId: String
}

type ImportRemoteLabbookPayload {
  activeBranch: String
  clientMutationId: String
}

# A query to get the status of a background task launched with the Dispatcher
type JobStatus implements Node {
  # The ID of the object.
  id: ID!
  jobKey: String
  status: String
  startedAt: String
  finishedAt: String
  result: String
}

type JobStatusConnection {
  pageInfo: PageInfo!
  edges: [JobStatusEdge]!
}

type JobStatusEdge {
  # The item at the end of the edge
  node: JobStatus

  # A cursor for use in pagination
  cursor: String!
}

# A type representing a LabBook and all of its contents
#
# LabBooks are uniquely identified by both the "owner" and the "name" of the LabBook
type Labbook implements Node, GitRepository {
  # The ID of the object.
  id: ID!
  name: String
  description: String
  owner: Owner
  activeBranch: LabbookRef
  defaultRemote: String
  branches(before: String, after: String, first: Int, last: Int): LabbookRefConnection
  collaborators: [String]
  canManageCollaborators: Boolean
  updatesAvailableCount: Int
  isRepoClean: Boolean
  environment: Environment
  code: LabbookSection
  input: LabbookSection
  output: LabbookSection
  activityRecords(before: String, after: String, first: Int, last: Int): ActivityConnection
  detailRecord(key: String): ActivityDetailObject
  detailRecords(keys: [String]): [ActivityDetailObject]
}

# An object representing a commit to a LabBook
type LabbookCommit implements GitCommit, Node {
  hash: String
  shortHash: String
  committedOn: String

  # The ID of the object.
  id: ID!
}

type LabbookConnection {
  pageInfo: PageInfo!
  edges: [LabbookEdge]!
}

type LabbookEdge {
  # The item at the end of the edge
  node: Labbook

  # A cursor for use in pagination
  cursor: String!
}

# A type representing a file or directory that has been favorited in the labbook file system.
type LabbookFavorite implements Node {
  # The ID of the object.
  id: ID!
  index: Int
  key: String
  description: String
  isDir: Boolean
}

type LabbookFavoriteConnection {
  pageInfo: PageInfo!
  edges: [LabbookFavoriteEdge]!
}

type LabbookFavoriteEdge {
  # The item at the end of the edge
  node: LabbookFavorite

  # A cursor for use in pagination
  cursor: String!
}

# A type representing a file or directory inside the labbook file system.
type LabbookFile implements Node {
  # The ID of the object.
  id: ID!
  isDir: Boolean
  isFavorite: Boolean
  modifiedAt: Int
  key: String
  size: Int
}

type LabbookFileConnection {
  pageInfo: PageInfo!
  edges: [LabbookFileEdge]!
}

type LabbookFileEdge {
  # The item at the end of the edge
  node: LabbookFile

  # A cursor for use in pagination
  cursor: String!
}

# An object representing a git reference in a LabBook repository
type LabbookRef implements Node, GitRef {
  # The ID of the object.
  id: ID!
  name: String
  prefix: String
  commit: LabbookCommit
}

type LabbookRefConnection {
  pageInfo: PageInfo!
  edges: [LabbookRefEdge]!
}

type LabbookRefEdge {
  # The item at the end of the edge
  node: LabbookRef

  # A cursor for use in pagination
  cursor: String!
}

# A type representing a section within a LabBook (i.e., code, input, output
#     
type LabbookSection implements Node {
  # The ID of the object.
  id: ID!
  files(root: String, before: String, after: String, first: Int, last: Int): LabbookFileConnection
  allFiles(before: String, after: String, first: Int, last: Int): LabbookFileConnection
  favorites(before: String, after: String, first: Int, last: Int): LabbookFavoriteConnection
}

input MakeLabbookDirectoryInput {
  owner: String!
  labbookName: String!
  section: String!
  directory: String!
  clientMutationId: String
}

type MakeLabbookDirectoryPayload {
  newLabbookFileEdge: LabbookFileEdge
  clientMutationId: String
}

input MoveLabbookFileInput {
  owner: String!
  labbookName: String!
  section: String!
  srcPath: String!
  dstPath: String!
  clientMutationId: String
}

# Method to move/rename a file or directory. If file, both src_path and dst_path should contain the file name.
# If a directory, be sure to include the trailing slash
type MoveLabbookFilePayload {
  newLabbookFileEdge: LabbookFileEdge
  clientMutationId: String
}

type Mutation {
  importLabbook(input: ImportLabbookInput!): ImportLabbookPayload
  importRemoteLabbook(input: ImportRemoteLabbookInput!): ImportRemoteLabbookPayload
  exportLabbook(input: ExportLabbookInput!): ExportLabbookPayload
  createLabbook(input: CreateLabbookInput!): CreateLabbookPayload
  renameLabbook(input: RenameLabbookInput!): RenameLabbookPayload
  publishLabbook(input: PublishLabbookInput!): PublishLabbookPayload
  syncLabbook(input: SyncLabbookInput!): SyncLabbookPayload
  createBranch(input: CreateBranchInput!): CreateBranchPayload
  checkoutBranch(input: CheckoutBranchInput!): CheckoutBranchPayload
  pullActiveBranchFromRemote(input: PullActiveBranchFromRemoteInput!): PullActiveBranchFromRemotePayload
  pushActiveBranchToRemote(input: PushActiveBranchToRemoteInput!): PushActiveBranchToRemotePayload
  addLabbookRemote(input: AddLabbookRemoteInput!): AddLabbookRemotePayload
  buildImage(input: BuildImageInput!): BuildImagePayload
  startContainer(input: StartContainerInput!): StartContainerPayload
  stopContainer(input: StopContainerInput!): StopContainerPayload
  createUserNote(input: CreateUserNoteInput!): CreateUserNotePayload
  addEnvironmentComponent(input: AddEnvironmentComponentInput!): AddEnvironmentComponentPayload
  addEnvironmentPackage(input: AddEnvironmentPackageInput!): AddEnvironmentPackagePayload
  addLabbookFile(input: AddLabbookFileInput!): AddLabbookFilePayload
  moveLabbookFile(input: MoveLabbookFileInput!): MoveLabbookFilePayload
  deleteLabbookFile(input: DeleteLabbookFileInput!): DeleteLabbookFilePayload
  makeLabbookDirectory(input: MakeLabbookDirectoryInput!): MakeLabbookDirectoryPayload
  removeUserIdentity(input: RemoveUserIdentityInput!): RemoveUserIdentityPayload
  addFavorite(input: AddLabbookFavoriteInput!): AddLabbookFavoritePayload
  updateFavorite(input: UpdateLabbookFavoriteInput!): UpdateLabbookFavoritePayload
  removeFavorite(input: RemoveLabbookFavoriteInput!): RemoveLabbookFavoritePayload
  addCollaborator(input: AddLabbookCollaboratorInput!): AddLabbookCollaboratorPayload
  deleteCollaborator(input: DeleteLabbookCollaboratorInput!): DeleteLabbookCollaboratorPayload
}

# An object with an ID
interface Node {
  # The ID of the object.
  id: ID!
}

# A type representing the owner of a LabBook or Dataset
type Owner implements Node, User {
  # The ID of the object.
  id: ID!
  username: String
  email: String
  givenName: String
  familyName: String
}

# A type that represents a Package Manager based Environment Component
type PackageManager implements Node {
  # The ID of the object.
  id: ID!
  packageManager: String!
  packageName: String!
  packageVersion: String
}

type PackageManagerConnection {
  pageInfo: PageInfo!
  edges: [PackageManagerEdge]!
}

type PackageManagerEdge {
  # The item at the end of the edge
  node: PackageManager

  # A cursor for use in pagination
  cursor: String!
}

type PageInfo {
  # When paginating forwards, are there more items?
  hasNextPage: Boolean!

  # When paginating backwards, are there more items?
  hasPreviousPage: Boolean!

  # When paginating backwards, the cursor to continue.
  startCursor: String

  # When paginating forwards, the cursor to continue.
  endCursor: String
}

input PublishLabbookInput {
  owner: String!
  labbookName: String!
  clientMutationId: String
}

type PublishLabbookPayload {
  success: Boolean
  clientMutationId: String
}

input PullActiveBranchFromRemoteInput {
  owner: String!
  labbookName: String!
  remoteName: String
  clientMutationId: String
}

type PullActiveBranchFromRemotePayload {
  success: Boolean
  clientMutationId: String
}

input PushActiveBranchToRemoteInput {
  owner: String!
  labbookName: String!
  remoteName: String
  clientMutationId: String
}

type PushActiveBranchToRemotePayload {
  success: Boolean
  clientMutationId: String
}

type Query {
  # The ID of the object
  node(id: ID!): Node
  labbook(owner: String, name: String): Labbook
  jobStatus(jobId: String): JobStatus
  backgroundJobs(before: String, after: String, first: Int, last: Int): JobStatusConnection
  localLabbooks(before: String, after: String, first: Int, last: Int): LabbookConnection
  availableBaseImages(before: String, after: String, first: Int, last: Int): BaseImageConnection
  availableBaseImageVersions(repository: String, namespace: String, component: String, before: String, after: String, first: Int, last: Int): BaseImageConnection
  availableDevEnvs(before: String, after: String, first: Int, last: Int): DevEnvConnection
  availableDevEnvVersions(repository: String, namespace: String, component: String, before: String, after: String, first: Int, last: Int): DevEnvConnection
  availableCustomDependencies(before: String, after: String, first: Int, last: Int): CustomDependencyConnection
  availableCustomDependenciesVersions(repository: String, namespace: String, component: String, before: String, after: String, first: Int, last: Int): CustomDependencyConnection
  userIdentity: UserIdentity
}

input RemoveLabbookFavoriteInput {
  owner: String!
  labbookName: String!
  section: String!
  index: Int!
  clientMutationId: String
}

type RemoveLabbookFavoritePayload {
  success: Boolean
  clientMutationId: String
}

input RemoveUserIdentityInput {
  clientMutationId: String
}

# Mutation to remove a locally stored user identity (no-op if not running in local mode)
type RemoveUserIdentityPayload {
  userIdentityEdge: UserIdentity
  clientMutationId: String
}

input RenameLabbookInput {
  owner: String!
  originalLabbookName: String!
  newLabbookName: String!
  clientMutationId: String
}

# Rename a labbook
type RenameLabbookPayload {
  success: Boolean
  clientMutationId: String
}

input StartContainerInput {
  owner: String!
  labbookName: String!
  clientMutationId: String
}

# Mutator to start a LabBook's Docker Image in a container
type StartContainerPayload {
  environment: Environment
  backgroundJobKey: String
  clientMutationId: String
}

input StopContainerInput {
  owner: String
  labbookName: String!
  clientMutationId: String
}

# Mutation to stop a Docker container. 
type StopContainerPayload {
  environment: Environment
  backgroundJobKey: String
  clientMutationId: String
}

input SyncLabbookInput {
  owner: String!
  labbookName: String!
  clientMutationId: String
}

type SyncLabbookPayload {
  updateCount: Int
  clientMutationId: String
}

input UpdateLabbookFavoriteInput {
  owner: String!
  labbookName: String!
  section: String!
  index: Int!
  updatedIndex: Int
  updatedKey: String
  updatedDescription: String
  clientMutationId: String
}

type UpdateLabbookFavoritePayload {
  updatedFavoriteEdge: LabbookFavoriteEdge
  clientMutationId: String
}

# Interface representing a user in the system
interface User {
  username: String
  email: String
  givenName: String
  familyName: String
}

# A type representing the identity of the logged in user
type UserIdentity implements Node, User {
  # The ID of the object.
  id: ID!
  username: String
  email: String
  givenName: String
  familyName: String
}
